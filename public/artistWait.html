<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtStream - Artist Waiting Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Raleway:wght@300;400;600;700&display=swap');

        :root {
            --bg-primary: #050814;
            --bg-secondary: #0a0e24;
            --accent-primary: #00ffff;
            --accent-secondary: #ff00ff;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        .neon-border {
            box-shadow: 0 0 5px var(--accent-primary),
                        0 0 10px var(--accent-primary),
                        0 0 15px var(--accent-primary),
                        0 0 20px var(--accent-primary);
        }

        .neon-text {
            text-shadow: 0 0 5px var(--accent-primary),
                         0 0 10px var(--accent-primary),
                         0 0 15px var(--accent-primary),
                         0 0 20px var(--accent-primary);
        }

        .artist-avatar {
            transition: all 0.3s ease;
        }

        .artist-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--accent-secondary);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        #artistCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>
<body class="min-h-screen overflow-hidden" x-data="artistWaitData()" x-init="init()">
    <canvas id="artistCanvas"></canvas>

    <div class="relative z-10 flex flex-col h-screen p-8">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-2 orbitron neon-text" x-text="streamName"></h1>
            <p class="text-xl text-gray-400" x-text="streamCategory + ' - ' + estimatedDuration"></p>
        </header>

        <div class="flex-grow flex space-x-8">
            <!-- Main Content -->
            <div class="w-2/3 space-y-8">
                <div class="bg-opacity-30 bg-gray-800 rounded-lg p-6 backdrop-filter backdrop-blur-md">
                    <h2 class="text-2xl font-semibold mb-4 orbitron">Stream Details</h2>
                    <p class="text-gray-300 text-lg mb-4" x-text="streamDescription"></p>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-opacity-50 bg-gray-700 rounded-lg p-4 text-center">
                            <i class="fas fa-users text-3xl text-blue-400 mb-2"></i>
                            <p class="text-sm text-gray-400">Artists</p>
                            <p class="text-2xl font-semibold"><span x-text="currentArtists"></span>/<span x-text="maxArtists"></span></p>
                        </div>
                        <div class="bg-opacity-50 bg-gray-700 rounded-lg p-4 text-center">
                            <i class="fas fa-comments text-3xl text-green-400 mb-2"></i>
                            <p class="text-sm text-gray-400">Chat</p>
                            <p class="text-2xl font-semibold" x-text="chatEnabled ? 'Enabled' : 'Disabled'"></p>
                        </div>
                        <div class="bg-opacity-50 bg-gray-700 rounded-lg p-4 text-center">
                            <i class="fas fa-clock text-3xl text-yellow-400 mb-2"></i>
                            <p class="text-sm text-gray-400">Estimated Start</p>
                            <p class="text-2xl font-semibold" x-text="estimatedStart"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-opacity-30 bg-gray-800 rounded-lg p-6 backdrop-filter backdrop-blur-md">
                    <h2 class="text-2xl font-semibold mb-4 orbitron">Connected Artists</h2>
                    <div class="grid grid-cols-3 gap-4" id="connectedArtistsList">
                        <!-- Connected artists will be dynamically added here -->
                    </div>
                </div>

                <div class="bg-opacity-30 bg-gray-800 rounded-lg p-6 backdrop-filter backdrop-blur-md">
                    <h2 class="text-2xl font-semibold mb-4 orbitron">Artistic Inspiration</h2>
                    <div class="text-center" id="inspirationQuote">
                        <p class="text-xl italic" x-text="inspirationQuote"></p>
                        <p class="mt-2 text-gray-400" x-text="inspirationAuthor"></p>
                    </div>
                </div>
            </div>

            <!-- Side Panel -->
            <div class="w-1/3 space-y-8">
                <div class="bg-opacity-30 bg-gray-800 rounded-lg p-6 backdrop-filter backdrop-blur-md">
                    <h2 class="text-2xl font-semibold mb-4 orbitron">Stream Status</h2>
                    <div class="flex items-center space-x-2 mb-4">
                        <span class="w-4 h-4 bg-yellow-500 rounded-full pulse"></span>
                        <p class="text-yellow-400 text-lg" x-text="statusMessage"></p>
                    </div>
                    <div class="bg-opacity-50 bg-gray-700 rounded-lg p-4">
                        <p class="text-sm text-gray-400 mb-2">Hosted by</p>
                        <div class="flex items-center space-x-3">
                            <img :src="hostAvatar" alt="Host Avatar" class="w-12 h-12 rounded-full">
                            <div>
                                <p class="font-semibold" x-text="hostName"></p>
                                <p class="text-sm text-gray-400" x-text="hostBio"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-opacity-30 bg-gray-800 rounded-lg p-6 backdrop-filter backdrop-blur-md">
                    <h2 class="text-2xl font-semibold mb-4 orbitron">Pre-Stream Checklist</h2>
                    <ul class="space-y-2">
                        <template x-for="(item, index) in checklist" :key="index">
                            <li class="flex items-center">
                                <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" :id="'check'+index" x-model="item.checked">
                                <label :for="'check'+index" class="ml-2 text-gray-400" x-text="item.text"></label>
                            </li>
                        </template>
                    </ul>
                </div>

                <div class="text-center">
                    <p class="text-lg text-gray-400 mb-4">Stream will begin automatically when the host is ready</p>
                    <div class="inline-block">
                        <i class="fas fa-palette text-6xl text-blue-400 animate-bounce"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function artistWaitData() {
            return {
                streamName: '',
                streamCategory: '',
                streamDescription: '',
                currentArtists: 1,
                maxArtists: 0,
                estimatedDuration: '',
                chatEnabled: true,
                streamId: '',
                connectedArtists: [],
                hostName: '',
                hostAvatar: '',
                hostBio: '',
                statusMessage: 'Waiting for host to start the stream',
                estimatedStart: '5 minutes',
                inspirationQuote: '',
                inspirationAuthor: '',
                checklist: [
                    { text: 'Test camera and microphone', checked: false },
                    { text: 'Prepare art supplies', checked: false },
                    { text: 'Set up lighting', checked: false },
                    { text: 'Have a glass of water ready', checked: false },
                    { text: 'Clear your workspace', checked: false }
                ],
                async init() {
                    await this.loadStreamData();
                    this.initBackgroundAnimation();
                    this.initWebSocket();
                    this.getInspirationQuote();
                },
                async loadStreamData() {
                    try {
                        const streamId = localStorage.getItem('currentStreamId');
                        if (!streamId) {
                            throw new Error('No stream ID found');
                        }
                        this.streamId = streamId;

                        const token = localStorage.getItem('token');
                        if (!token) {
                            throw new Error('No authentication token found');
                        }
                        const response = await axios.get(`/streams/${streamId}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        const streamData = response.data;
                        this.streamName = streamData.name;
                        this.streamCategory = streamData.category;
                        this.streamDescription = streamData.description;
                        this.maxArtists = streamData.maxArtists;
                        this.estimatedDuration = streamData.estimatedDuration + ' minutes';
                        this.chatEnabled = streamData.chatEnabled;
                        this.currentArtists = streamData.participants.length;
                        this.connectedArtists = streamData.participants.map(participant => ({
                            id: participant.userId,
                            username: participant.username,
                            avatar: `https://i.pravatar.cc/150?u=${participant.username}`
                        }));
                        this.hostName = streamData.hostName;
                        this.hostAvatar = `https://i.pravatar.cc/150?u=${streamData.hostName}`;
                        this.hostBio = "Passionate artist and stream host";

                        this.updateConnectedArtistsList();
                    } catch (error) {
                        console.error('Error loading stream data:', error);
                    }
                },
                initBackgroundAnimation() {
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('artistCanvas'), alpha: true});
                    renderer.setSize(window.innerWidth, window.innerHeight);

                    const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
                    const material = new THREE.MeshBasicMaterial({color: 0x00ffff, wireframe: true});
                    const torusKnot = new THREE.Mesh(geometry, material);
                    scene.add(torusKnot);

                    camera.position.z = 30;

                    function animate() {
                        requestAnimationFrame(animate);
                        torusKnot.rotation.x += 0.01;
                        torusKnot.rotation.y += 0.01;
                        renderer.render(scene, camera);
                    }
                    animate();

                    window.addEventListener('resize', () => {
                        camera.aspect = window.innerWidth / window.innerHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(window.innerWidth, window.innerHeight);
                    });
                },
                initWebSocket() {
                    const socket = new WebSocket('wss://your-websocket-server.com');

                    socket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        switch(data.type) {
                            case 'artistJoined':
                                this.connectedArtists.push({
                                    id: data.artist.id,
                                    username: data.artist.username,
                                    avatar: `https://i.pravatar.cc/150?u=${data.artist.username}`
                                });
                                this.currentArtists = this.connectedArtists.length;
                                this.updateConnectedArtistsList();
                                break;
                            case 'artistLeft':
                                this.connectedArtists = this.connectedArtists.filter(artist => artist.id !== data.artistId);
                                this.currentArtists = this.connectedArtists.length;
                                this.updateConnectedArtistsList();
                                break;
                            case 'streamStarted':
                                this.statusMessage = 'Host has started the stream';
                                break;
                            case 'streamLive':
                                window.location.href = 'stream.html';
                                break;
                        }
                    };

                    socket.onerror = (error) => {
                        console.error('WebSocket error:', error);
                    };

                    socket.onclose = () => {
                        console.log('WebSocket connection closed');
                    };
                },
                updateConnectedArtistsList() {
                    const artistsList = document.getElementById('connectedArtistsList');
                    artistsList.innerHTML = '';
                    this.connectedArtists.forEach(artist => {
                        const artistEl = document.createElement('div');
                        artistEl.className = 'bg-opacity-50 bg-gray-700 rounded-lg p-4 flex items-center space-x-3 artist-avatar';
                        artistEl.innerHTML = `
                            <img src="${artist.avatar}" alt="${artist.username}" class="w-12 h-12 rounded-full">
                            <div>
                                <p class="font-semibold">${artist.username}</p>
                                <p class="text-sm text-gray-400">Artist</p>
                            </div>
                        `;
                        artistsList.appendChild(artistEl);
                    });

                    // Animate new artists joining
                    gsap.from('.artist-avatar', {
                        opacity: 0,
                        y: 20,
                        stagger: 0.1,
                        duration: 0.5,
                        ease: "power2.out"
                    });
                },
                getInspirationQuote() {
                    const quotes = [
                        { text: "Every artist was first an amateur.", author: "Ralph Waldo Emerson" },
                        { text: "Creativity takes courage.", author: "Henri Matisse" },
                        { text: "Art enables us to find ourselves and lose ourselves at the same time.", author: "Thomas Merton" },
                        { text: "The painter has the Universe in his mind and hands.", author: "Leonardo da Vinci" },
                        { text: "To be an artist is to believe in life.", author: "Henry Moore" }
                    ];
                    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                    this.inspirationQuote = randomQuote.text;
                    this.inspirationAuthor = randomQuote.author;

                    // Animate quote change
                    gsap.from('#inspirationQuote', {
                        opacity: 0,
                        y: 10,
                        duration: 1,
                        ease: "power2.out"
                    });
                },
                pollStreamStatus() {
                    setInterval(async () => {
                        try {
                            const response = await axios.get(`https://api.thetavideoapi.com/stream/${this.streamId}`, {
                                headers: {
                                    'x-tva-sa-id': 'srvacc_uaef6ix91e360bvt2zw31n2hf',
                                    'x-tva-sa-secret': '231c167vuc8d1ik6i3yhkqt5y404v0wb'
                                }
                            });
                            
                            if (response.data.body.status === 'on') {
                                window.location.href = 'stream.html';
                            }
                        } catch (error) {
                            console.error('Error polling stream status:', error);
                        }
                    }, 5000); // Poll every 5 seconds
                }
            }
        }

        // Initialize Alpine.js
        document.addEventListener('alpine:init', () => {
            Alpine.data('artistWaitData', artistWaitData);
        });
    </script>
</body>
</html>