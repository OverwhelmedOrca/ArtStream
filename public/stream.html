<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtStream Live - Enhanced</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy-bundle.umd.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #4a0e4e, #081730, #0a2472);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .canvas-container {
            background-color: white;
            border-radius: 0.5rem;
            overflow: hidden;
            flex-grow: 1;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }
        .tool-btn {
            width: 40px;
            height: 40px;
            transition: all 0.3s ease;
        }
        .tool-btn:hover {
            transform: scale(1.1);
        }
        .chat-message {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        .chat-message:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .reaction-btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
        }
        .reaction-btn:hover {
            transform: scale(1.1);
        }
        .gift-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
        }
        .gift-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .tool-panel {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .layer-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="p-4 flex flex-col h-screen">
    <header class="flex justify-between items-center mb-4">
        <h1 class="text-3xl font-bold">ArtStream Live</h1>
        <div class="flex items-center space-x-4">
            <div class="text-sm">
                <span class="mr-2 tooltip" data-tippy-content="Stream Duration"><i class="far fa-clock"></i> 1:23:45</span>
                <span class="mr-2 tooltip" data-tippy-content="Viewers"><i class="fas fa-users"></i> 1,234</span>
                <span class="mr-2 tooltip" data-tippy-content="Art Progress"><i class="fas fa-palette"></i> 3/5</span>
                <span class="tooltip" data-tippy-content="Likes"><i class="fas fa-thumbs-up"></i> 567</span>
            </div>
            <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition duration-300">
                End Stream
            </button>
        </div>
    </header>

    <div class="flex gap-4 flex-grow">
        <div class="flex-1 flex flex-col">
            <div class="canvas-container mb-4 flex-grow">
                <canvas id="drawing-canvas"></canvas>
            </div>
            <div class="tool-panel flex flex-wrap items-center space-x-4">
                <div id="brush-menu" class="relative">
                    <button id="brush-tool" class="tool-btn bg-blue-500 hover:bg-blue-600 text-white rounded" data-tippy-content="Brush Tool">
                        <i class="fas fa-paint-brush"></i>
                    </button>
                </div>
                <div id="shape-menu" class="relative">
                    <button id="shape-tool" class="tool-btn bg-purple-500 hover:bg-purple-600 text-white rounded" data-tippy-content="Shape Tool">
                        <i class="fas fa-shapes"></i>
                    </button>
                </div>
                <button id="eraser-tool" class="tool-btn bg-gray-500 hover:bg-gray-600 text-white rounded" data-tippy-content="Eraser Tool">
                    <i class="fas fa-eraser"></i>
                </button>
                <button id="text-tool" class="tool-btn bg-yellow-500 hover:bg-yellow-600 text-white rounded" data-tippy-content="Text Tool">
                    <i class="fas fa-font"></i>
                </button>
                <button id="eyedropper-tool" class="tool-btn bg-pink-500 hover:bg-pink-600 text-white rounded" data-tippy-content="Eyedropper Tool">
                    <i class="fas fa-eye-dropper"></i>
                </button>
                <div id="color-picker-container"></div>
                <input type="range" id="brush-size" min="1" max="50" value="5" class="w-32" data-tippy-content="Brush Size">
                <select id="blend-mode" class="bg-gray-700 text-white rounded px-2 py-1" data-tippy-content="Blend Mode">
                    <option value="normal">Normal</option>
                    <option value="multiply">Multiply</option>
                    <option value="screen">Screen</option>
                    <option value="overlay">Overlay</option>
                </select>
                <button id="clear-canvas" class="tool-btn bg-red-500 hover:bg-red-600 text-white rounded" data-tippy-content="Clear Canvas">
                    <i class="fas fa-trash"></i>
                </button>
                <button id="save-canvas" class="tool-btn bg-green-500 hover:bg-green-600 text-white rounded" data-tippy-content="Save Canvas">
                    <i class="fas fa-save"></i>
                </button>
            </div>
        </div>

        <div class="w-96 flex flex-col">
            <div class="bg-gray-800 rounded-lg p-4 flex-grow flex flex-col">
                <div class="flex mb-2">
                    <button id="viewers-tab" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-l transition duration-300">Viewers</button>
                    <button id="artists-tab" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-r transition duration-300">Artists</button>
                </div>
                <div id="chat-messages" class="flex-grow bg-gray-700 rounded-lg p-2 overflow-y-auto mb-2 space-y-2">
                    <!-- Chat messages will be inserted here -->
                </div>
                <div class="flex mb-2">
                    <input type="text" id="chat-input" class="flex-1 bg-gray-700 rounded-l-lg p-2 outline-none" placeholder="Type a message...">
                    <button id="send-message" class="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-r-lg transition duration-300">Send</button>
                </div>
                <button id="send-gift" class="gift-btn">
                    <i class="fas fa-gift mr-2"></i> Send Gift
                </button>
            </div>
            <div class="tool-panel mt-4">
                <h3 class="text-lg font-bold mb-2">Layers</h3>
                <div id="layers-list">
                    <!-- Layer items will be inserted here -->
                </div>
                <button id="add-layer" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded mt-2">
                    Add Layer
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Fabric.js canvas
        const canvas = new fabric.Canvas('drawing-canvas', {
            isDrawingMode: true,
            width: window.innerWidth * 0.7,
            height: window.innerHeight * 0.75,
        });

        // Initialize color picker
        const pickr = Pickr.create({
            el: '#color-picker-container',
            theme: 'classic',
            default: '#000000',
            components: {
                preview: true,
                opacity: true,
                hue: true,
                interaction: {
                    hex: true,
                    rgba: true,
                    hsla: true,
                    hsva: true,
                    cmyk: true,
                    input: true,
                    clear: true,
                    save: true
                }
            }
        });

        pickr.on('change', (color) => {
            const rgba = color.toRGBA().toString();
            canvas.freeDrawingBrush.color = rgba;
            if (canvas.getActiveObject()) {
                canvas.getActiveObject().set('fill', rgba);
                canvas.renderAll();
            }
        });

        // Brush types
        const brushTypes = {
            normal: fabric.PencilBrush,
            highlighter: fabric.PencilBrush,
            fountain: fabric.SprayBrush,
            pencil: fabric.PencilBrush,
            pattern: fabric.PatternBrush
        };

        // Create brush menu
        const brushMenu = document.createElement('div');
        brushMenu.className = 'absolute top-full left-0 bg-white rounded shadow-lg p-2 hidden';
        Object.keys(brushTypes).forEach(type => {
            const button = document.createElement('button');
            button.className = 'block w-full text-left px-2 py-1 hover:bg-gray-200';
            button.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            button.onclick = () => {
                canvas.freeDrawingBrush = new brushTypes[type](canvas);
                updateBrushSettings();
                brushMenu.classList.add('hidden');
            };
            brushMenu.appendChild(button);
        });
        document.getElementById('brush-menu').appendChild(brushMenu);

        document.getElementById('brush-tool').onclick = () => {
            brushMenu.classList.toggle('hidden');
        };

        // Create shape menu
        const shapeMenu = document.createElement('div');
        shapeMenu.className = 'absolute top-full left-0 bg-white rounded shadow-lg p-2 hidden';
        ['Rectangle', 'Circle', 'Triangle', 'Star'].forEach(shape => {
            const button = document.createElement('button');
            button.className = 'block w-full text-left px-2 py-1 hover:bg-gray-200';
            button.textContent = shape;
            button.onclick = () => {
                addShape(shape.toLowerCase());
                shapeMenu.classList.add('hidden');
            };
            shapeMenu.appendChild(button);
        });
        document.getElementById('shape-menu').appendChild(shapeMenu);

        document.getElementById('shape-tool').onclick = () => {
            shapeMenu.classList.toggle('hidden');
        };

        function addShape(shape) {
            let fabricShape;
            switch (shape) {
                case 'rectangle':
                    fabricShape = new fabric.Rect({
                        width: 100,
                        height: 100,
                        fill: pickr.getColor().toRGBA().toString()
                    });
                    break;
                case 'circle':
                    fabricShape = new fabric.Circle({
                        radius: 50,
                        fill: pickr.getColor().toRGBA().toString()
                    });
                    break;
                case 'triangle':
                    fabricShape = new fabric.Triangle({
                        width: 100,
                        height: 100,
                        fill: pickr.getColor().toRGBA().toString()
                    });
                    break;
                case 'star':
                    fabricShape = new fabric.Path('M 0 -50 L 14 -20 L 47 -15 L 23 7 L 29 40 L 0 25 L -29 40 L -23 7 L -47 -15 L -14 -20 Z', {
                        fill: pickr.getColor().toRGBA().toString(),
                        left: 100,
                        top: 100,
                        scaleX: 2,
                        scaleY: 2
                    });
                    break;
            }
            canvas.add(fabricShape);
            canvas.setActiveObject(fabricShape);
            canvas.renderAll();
        }

        // Eraser tool
        document.getElementById('eraser-tool').onclick = () => {
            canvas.isDrawingMode = true;
            canvas.freeDrawingBrush = new fabric.EraserBrush(canvas);
            updateBrushSettings();
        };

        // Text tool
        document.getElementById('text-tool').onclick = () => {
            const text = new fabric.IText('Type here', {
                left: 50,
                top: 50,
                fontFamily: 'Arial',
                fill: pickr.getColor().toRGBA().toString(),
                fontSize: 20
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        };

// Eyedropper tool
document.getElementById('eyedropper-tool').onclick = () => {
    canvas.isDrawingMode = false;
    canvas.on('mouse:down', function(event) {
        if (event.target) {
            let color = event.target.fill;
            pickr.setColor(color);
        }
    });
};

// Update brush settings
function updateBrushSettings() {
    if (canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.width = parseInt(document.getElementById('brush-size').value, 10);
        canvas.freeDrawingBrush.color = pickr.getColor().toRGBA().toString();
    }
}

document.getElementById('brush-size').oninput = updateBrushSettings;
document.getElementById('blend-mode').onchange = function() {
    if (canvas.getActiveObject()) {
        canvas.getActiveObject().set('globalCompositeOperation', this.value);
        canvas.renderAll();
    }
};

// Clear and save canvas
document.getElementById('clear-canvas').onclick = () => canvas.clear();
document.getElementById('save-canvas').onclick = () => {
    const link = document.createElement('a');
    link.href = canvas.toDataURL({format: 'png', quality: 0.8});
    link.download = 'artstream-drawing.png';
    link.click();
};

// Layer management
let layerCount = 1;

function addNewLayer() {
    const newLayer = new fabric.Group([], {
        name: `Layer ${layerCount}`
    });
    canvas.add(newLayer);
    canvas.setActiveObject(newLayer);
    updateLayersList();
    layerCount++;
}

function updateLayersList() {
    const layersList = document.getElementById('layers-list');
    layersList.innerHTML = '';
    canvas.getObjects().forEach((obj, index) => {
        if (obj.type === 'group') {
            const layerItem = document.createElement('div');
            layerItem.className = 'layer-item';
            layerItem.innerHTML = `
                <span>${obj.name}</span>
                <button class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded" onclick="deleteLayer(${index})">Delete</button>
            `;
            layersList.appendChild(layerItem);
        }
    });
}

function deleteLayer(index) {
    const objects = canvas.getObjects();
    if (objects[index].type === 'group') {
        canvas.remove(objects[index]);
        updateLayersList();
    }
}

document.getElementById('add-layer').onclick = addNewLayer;

// Chat functionality
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const sendMessage = document.getElementById('send-message');
const viewersTab = document.getElementById('viewers-tab');
const artistsTab = document.getElementById('artists-tab');
const sendGift = document.getElementById('send-gift');

let currentChatType = 'viewers';

function createChatMessage(user, message, time, isArtist = false) {
    const messageElement = document.createElement('div');
    messageElement.className = `chat-message ${isArtist ? 'artist' : 'viewer'}`;
    messageElement.innerHTML = `
        <div class="flex justify-between items-start mb-1">
            <span class="font-bold ${isArtist ? 'text-yellow-400' : ''}">${user}</span>
            <span class="text-xs text-gray-400">${time}</span>
        </div>
        <p class="mb-2">${message}</p>
        <div class="flex space-x-2">
            <button class="reaction-btn bg-blue-500 hover:bg-blue-600">
                <i class="fas fa-thumbs-up"></i> Like
            </button>
            <button class="reaction-btn bg-red-500 hover:bg-red-600">
                <i class="fas fa-thumbs-down"></i> Dislike
            </button>
        </div>
    `;
    return messageElement;
}

function addMessage(user, message, isArtist = false) {
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const messageElement = createChatMessage(user, message, time, isArtist);
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

sendMessage.onclick = () => {
    const message = chatInput.value.trim();
    if (message) {
        addMessage('You', message, currentChatType === 'artists');
        chatInput.value = '';
    }
};

chatInput.onkeypress = (e) => {
    if (e.key === 'Enter') {
        sendMessage.click();
    }
};

viewersTab.onclick = () => {
    currentChatType = 'viewers';
    viewersTab.classList.remove('bg-gray-600');
    viewersTab.classList.add('bg-blue-500');
    artistsTab.classList.remove('bg-blue-500');
    artistsTab.classList.add('bg-gray-600');
    updateChatMessages();
};

artistsTab.onclick = () => {
    currentChatType = 'artists';
    artistsTab.classList.remove('bg-gray-600');
    artistsTab.classList.add('bg-blue-500');
    viewersTab.classList.remove('bg-blue-500');
    viewersTab.classList.add('bg-gray-600');
    updateChatMessages();
};

function updateChatMessages() {
    chatMessages.innerHTML = '';
    if (currentChatType === 'viewers') {
        addMessage('ArtLover123', 'Wow, loving this stream! The colors are amazing!');
        addMessage('CreativeSoul', 'Can you share some tips on blending techniques?');
        addMessage('ArtEnthusiast', 'This is so inspiring! Keep up the great work!');
    } else {
        addMessage('FamousArtist1', 'Great use of color theory in your work!', true);
        addMessage('DigitalMasterX', 'Have you tried using layer masks for more control?', true);
        addMessage('ArtistMod', 'Remember to stay respectful in the chat, everyone!', true);
    }
}

updateChatMessages();

sendGift.onclick = () => {
    const giftOptions = ['🎨', '👏', '💐', '🏆', '💖'];
    const randomGift = giftOptions[Math.floor(Math.random() * giftOptions.length)];
    addMessage('You', `Sent a gift: ${randomGift}`);
    
    // Animate the gift
    const giftElement = document.createElement('div');
    giftElement.textContent = randomGift;
    giftElement.style.position = 'absolute';
    giftElement.style.fontSize = '3rem';
    giftElement.style.left = '50%';
    giftElement.style.bottom = '0';
    giftElement.style.transform = 'translateX(-50%)';
    giftElement.style.transition = 'all 2s ease-out';
    document.body.appendChild(giftElement);

    setTimeout(() => {
        giftElement.style.bottom = '80%';
        giftElement.style.opacity = '0';
    }, 100);

    setTimeout(() => {
        document.body.removeChild(giftElement);
    }, 2000);
};

// Initialize tooltips
tippy('[data-tippy-content]');

// Responsive canvas sizing
function resizeCanvas() {
    canvas.setDimensions({
        width: window.innerWidth * 0.7,
        height: window.innerHeight * 0.75
    });
    canvas.renderAll();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Initialize the first layer
addNewLayer();
</script>
</body>
</html>